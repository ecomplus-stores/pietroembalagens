(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{238:function(i,e,t){"use strict";t(4);var s=t(20),p=t(26),h=t(35),n=t(71),a=t(27),o=t(2),r=t(241),l=t(243),c=t.n(l),d=t(249);const u="object"==typeof window&&window.localStorage,g="shipping-to-zip",m=i=>{const e={};return["product_id","variation_id","sku","name","quantity","inventory","currency_id","currency_symbol","price","final_price","dimensions","weight"].forEach((t=>{void 0!==i[t]&&(e[t]=i[t])})),e};var S={name:"ShippingCalculator",components:{CleaveInput:c.a,ShippingLine:d.a},props:{zipCode:String,canSelectServices:Boolean,canInputZip:{type:Boolean,default:!0},countryCode:{type:String,default:p.$ecomConfig.get("country_code")},shippedItems:{type:Array,default:()=>[]},shippingResult:{type:Array,default:()=>[]},shippingData:{type:Object,default:()=>({})},skipAppIds:Array,shippingAppsSort:{type:Array,default:()=>window.ecomShippingApps||[]}},data:()=>({localZipCode:null,localShippedItems:[],amountSubtotal:null,shippingServices:[],selectedService:null,hasPaidOption:!1,freeFromValue:null,isScheduled:!1,retryTimer:null,isWaiting:!1,hasCalculated:!1}),computed:{i19add$1ToEarn:()=>Object(h.a)(s.j),i19calculateShipping:()=>Object(h.a)(s.D),i19zipCode:()=>Object(h.a)(s.te),i19freeShipping:()=>Object(h.a)(s.Bb).toLowerCase(),cleaveOptions(){return"BR"===this.countryCode?{blocks:[5,3],delimiter:"-"}:{blocks:[30]}},freeFromPercentage(){return this.hasPaidOption&&this.amountSubtotal<this.freeFromValue?Math.round(100*this.amountSubtotal/this.freeFromValue):null},productionDeadline(){let i=0;return this.shippedItems.forEach((e=>{if(e.quantity&&e.production_time){const{days:t,cumulative:s}=e.production_time,p=s?t*e.quantity:t;p>i&&(i=p)}})),i}},methods:{formatMoney:n.a,updateZipCode(){this.$emit("update:zip-code",this.localZipCode)},parseShippingOptions(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.freeFromValue=null,this.shippingServices=[],i.length&&(i.forEach((i=>{const{validated:e,error:t,response:s}=i;if(!e||t)return;if(this.skipAppIds&&this.skipAppIds.includes(i.app_id))return;s.shipping_services.forEach((e=>{this.shippingServices.push({app_id:i.app_id,...e})}));const p=s.free_shipping_from_value;p&&(!this.freeFromValue||this.freeFromValue>p)&&(this.freeFromValue=p)})),this.shippingServices.length?(this.shippingServices=this.shippingServices.sort(((i,e)=>{const t=i.shipping_line.total_price-e.shipping_line.total_price;return t<0?-1:t>0?1:i.shipping_line.delivery_time&&e.shipping_line.delivery_time&&i.shipping_line.delivery_time.days<e.shipping_line.delivery_time.days?-1:1})),this.hasPaidOption=Boolean(this.shippingServices.find((i=>i.shipping_line.total_price||i.shipping_line.price))),Array.isArray(this.shippingAppsSort)&&this.shippingAppsSort.length&&(this.shippingServices=Object(r.a)(this.shippingServices,this.shippingAppsSort))):e?this.scheduleRetry():this.fetchShippingServices(!0))},scheduleRetry(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;clearTimeout(this.retryTimer),this.retryTimer=setTimeout((()=>{this.localZipCode&&!this.shippingServices.length&&this.shippedItems.length&&this.fetchShippingServices(!0)}),i)},fetchShippingServices(i){this.isScheduled||(this.isScheduled=!0,setTimeout((()=>{this.isScheduled=!1;const{storeId:e}=this;let t="/calculate_shipping.json";this.skipAppIds&&this.skipAppIds.length&&(t+="?skip_ids=",this.skipAppIds.forEach(((i,e)=>{e>0&&(t+=","),t+=`${i}`})));const s={...this.shippingData,to:{zip:this.localZipCode,...this.shippingData.to}};this.localShippedItems.length&&(s.items=this.localShippedItems,s.subtotal=this.amountSubtotal),this.isWaiting=!0,Object(o.c)({url:t,method:"POST",storeId:e,data:s}).then((e=>{let{data:t}=e;return this.parseShippingOptions(t.result,i)})).catch((e=>{i||this.scheduleRetry(4e3),console.error(e)})).finally((()=>{this.hasCalculated=!0,this.isWaiting=!1}))}),this.hasCalculated?150:50))},submitZipCode(){this.updateZipCode(),u&&u.setItem(g,this.localZipCode),this.fetchShippingServices()},setSelectedService(i){this.canSelectServices&&(this.$emit("select-service",this.shippingServices[i]),this.selectedService=i)}},watch:{shippedItems:{handler(){setTimeout((()=>{this.localShippedItems=this.shippedItems.map(m);const{amountSubtotal:i}=this;this.amountSubtotal=this.shippedItems.reduce(((i,e)=>i+Object(a.a)(e)*e.quantity),0),this.hasCalculated&&(this.canSelectServices||i!==this.amountSubtotal||!this.shippingServices.length&&!this.isWaiting)&&this.fetchShippingServices()}),50)},deep:!0,immediate:!0},localZipCode(i){"BR"===this.countryCode&&8===i.replace(/\D/g,"").length&&this.submitZipCode()},zipCode:{handler(i){i&&(this.localZipCode=i)},immediate:!0},skipAppIds(){this.fetchShippingServices()},shippingResult:{handler(i){i.length&&this.parseShippingOptions(i)},immediate:!0}},created(){if(!this.zipCode&&u){const i=u.getItem(g);i&&(this.localZipCode=i)}}};e.a=S}}]);