(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{248:function(t,e,s){"use strict";s(4);var i=s(20),a=s(35),r=s(42),l=s(51),n=s(255),o=s(242),c=s(194),h=s(0);const d=t=>{let{ecomSearch:e,term:s,page:i,defaultSort:a}=t;e.reset(),a&&e.setSortOrder(a),s&&e.setSearchTerm(s),i&&e.setPageNumber(i)};var u={name:"SearchEngine",components:{Portal:n.a,ABackdrop:o.a,ProductCard:c.a},props:{term:String,page:{type:Number,default:1},pageSize:{type:Number,default:24},brands:Array,categories:Array,isFixedBrands:Boolean,isFixedCategories:Boolean,defaultSort:String,defaultFilters:Object,autoFixScore:{type:Number,default:.6},isFilterable:{type:Boolean,default:!0},hasPopularItems:{type:Boolean,default:!0},canLoadMore:{type:Boolean,default:!0},loadMoreSelector:String,canRetry:{type:Boolean,default:!0},canShowItems:{type:Boolean,default:!0},productCardProps:Object,gridsData:{type:Array,default(){if("object"==typeof window&&window.storefront&&window.storefront.data)return window.storefront.data.grids}}},data:()=>({suggestedTerm:"",resultItems:[],totalSearchResults:0,hasSearched:!1,noResultsTerm:"",keepNoResultsTerm:!1,filters:[],lastSelectedFilter:null,selectedOptions:{},selectedSortOption:null,countOpenRequests:0,lastRequestId:null,isScheduled:!1,isLoadingMore:!1,hasNetworkError:!1,popularItems:[],hasSetPopularItems:!1,isAsideVisible:!1,searchFilterId:0,isMobile:h.isMobile}),computed:{i19clearFilters:()=>Object(a.a)(i.N),i19closeFilters:()=>Object(a.a)(i.P),i19didYouMean:()=>Object(a.a)(i.gb),i19filter:()=>Object(a.a)(i.yb),i19filterResults:()=>Object(a.a)(i.zb),i19itemsFound:()=>Object(a.a)(i.ac),i19noResultsFor:()=>Object(a.a)(i.xc),i19popularProducts:()=>Object(a.a)(i.Yc),i19refineSearch:()=>Object(a.a)(i.md),i19relevance:()=>Object(a.a)(i.pd),i19results:()=>Object(a.a)(i.td),i19searchAgain:()=>Object(a.a)(i.zd),i19searchingFor:()=>Object(a.a)(i.Cd),i19searchOfflineErrorMsg:()=>Object(a.a)(i.Ad),i19sort:()=>Object(a.a)(i.Sd),ecomSearch:()=>new l.a,isSearching(){return this.countOpenRequests>0},hasEmptyResult(){return this.hasSearched&&!this.resultItems.length},sortOptions:()=>[{value:null,label:Object(a.a)(i.pd)},{value:"sales",label:Object(a.a)(i.vd)},{value:"lowest_price",label:Object(a.a)(i.gc)},{value:"highest_price",label:Object(a.a)(i.Nb)},{value:"news",label:Object(a.a)(i.od)},{value:"slug",label:Object(a.a)(i.qc)}],hasSelectedOptions(){for(const t in this.selectedOptions)if(this.selectedOptions[t]&&this.selectedOptions[t].length)return!0;return!1},isNavVisible(){return this.hasSearched&&this.isFilterable&&(this.isSearching||this.totalSearchResults>8||this.hasSelectedOptions)},isResultsVisible(){return this.hasSearched&&!this.isSearching||this.suggestedItems.length},hasFilters(){return this.hasSelectedOptions||this.filters.find((t=>{let{options:e}=t;return e.length}))},suggestedItems(){return this.resultItems.length?this.resultItems:this.popularItems},loadObserver(){return this.canLoadMore&&Object(r.a)("#search-engine-load-more",{load:()=>{this.isLoadingMore=!0,this.fetchItems()}})}},methods:{fetchItems(t,e){const s=e?new l.a:this.ecomSearch,i=Date.now();this.countOpenRequests++,this.lastRequestId=i,this.isLoadingMore&&s.setPageNumber(this.page+Math.ceil(this.resultItems.length/this.pageSize));const a=s.setPageSize(this.pageSize).fetch().then((t=>(this.lastRequestId===i&&(this.hasNetworkError=!1,e||this.handleSearchResult()),!e&&(this.term||this.brands||this.categories)||(this.hasSetPopularItems=!0,this.popularItems=s.getItems()),t))).catch((s=>{console.error(s),(this.lastRequestId===i||e)&&(!this.canRetry||t||s.response&&400===s.response.status?this.hasNetworkError=!0:this.fetchItems(!0,e))})).finally((()=>{this.countOpenRequests--,this.isLoadingMore=!1}));this.$emit("fetch",{ecomSearch:s,fetching:a})},updateFilters(){const t=[],e=(e,s,i)=>{s.sort(((t,e)=>e.key>t.key?-1:1));let a=this.filters.findIndex((t=>t.filter===e));if(e!==this.lastSelectedFilter){if(-1===a&&(a=this.filters.length),this[`isFixed${e}`]){const t=this[e.toLowerCase()];t&&(s=s.filter((e=>{let{key:s}=e;return-1===t.indexOf(s)})))}this.filters[a]={filter:e,options:s,isSpec:i};const t=this.selectedOptions[e]?this.selectedOptions[e].filter((t=>s.find((e=>{let{key:s}=e;return s===t})))):[];this.$set(this.selectedOptions,e,t)}t.push(a)};e("Brands",this.ecomSearch.getBrands()),e("Categories",this.ecomSearch.getCategories()),this.ecomSearch.getSpecs().forEach(((t,s)=>{let{key:i,options:a}=t;e(i,a,!0)})),this.filters=this.filters.filter(((e,s)=>t.includes(s))),this.searchFilterId=Date.now()},handleSuggestions(){if(this.term){const{ecomSearch:t}=this,e=this.term.toLowerCase();let s=e,i=!1;this.suggestedTerm="",t.getTermSuggestions().forEach((t=>{let{options:a,text:r}=t;if(a.length){const t=a[0],l=t.text.toLowerCase();!this.totalSearchResults&&this.autoFixScore>0&&t.score>=this.autoFixScore&&-1===l.indexOf(e)&&(i=!0),s=s.replace(new RegExp(r,"i"),l)}})),this.keepNoResultsTerm?this.keepNoResultsTerm=!1:this.noResultsTerm="",s!==e&&(i?(this.noResultsTerm=e,this.keepNoResultsTerm=!0,this.$emit("update:term",s)):this.suggestedTerm=s,t.history.shift())}},handleSearchResult(){const{ecomSearch:t}=this;if(this.totalSearchResults=t.getTotalCount(),this.resultItems=this.isLoadingMore?this.resultItems.concat(t.getItems()):t.getItems(),this.updateFilters(),!this.hasSearched&&this.defaultFilters)for(const t in this.defaultFilters){const e=this.defaultFilters[t];Array.isArray(e)?e.forEach((e=>this.setFilterOption(t,e,!0))):"string"==typeof e&&this.setFilterOption(t,e,!0)}this.handleSuggestions(),this.totalSearchResults||!this.hasPopularItems||this.hasSetPopularItems||this.fetchItems(!1,!0),this.$emit(this.isLoadingMore?"load-more":"search",{ecomSearch:t}),this.hasSearched||this.$nextTick((()=>{setTimeout((()=>{this.hasSearched=!0}),100)}))},scheduleFetch(){this.isScheduled||(this.isScheduled=!0,this.$nextTick((()=>{setTimeout((()=>{this.fetchItems(),this.isScheduled=!1}),30)})))},resetAndFetch(){d(this),this.handlePresetedOptions(),this.scheduleFetch()},toggleFilters(t){this.isAsideVisible="boolean"==typeof t?t:!this.isAsideVisible},getFilterLabel(t){switch(t){case"Brands":return Object(a.a)(i.x);case"Categories":return Object(a.a)(i.H);default:if(this.gridsData){const e=this.gridsData.find((e=>e.grid_id===t));if(e)return e.title||e.grid_id}}return t},handlePresetedOptions(){["brands","categories"].forEach((t=>{if(this[t]&&this[t].length){const e=t.charAt(0).toUpperCase()+t.slice(1);this[`isFixed${e}`]||(this.selectedOptions[e]=this[t]),this.updateSearchFilter(e)}}))},updateSearchFilter(t){const{ecomSearch:e}=this;let s=this.selectedOptions[t];switch(void 0!==s&&s.length||(s=null),t){case"Brands":this.isFixedBrands&&this.brands&&(s=s?s.concat(this.brands):this.brands),e.setBrandNames(s);break;case"Categories":e.setCategoryNames(s),this.isFixedCategories&&this.categories&&e.mergeFilter({terms:{"categories.name":this.categories}});break;default:e.setSpec(t,s)}},setFilterOption(t,e,s){const{selectedOptions:i}=this,a=i[t];if(a){const i=a.indexOf(e);s?-1===i&&(this.lastSelectedFilter=t,a.push(e)):(i>-1&&a.splice(i,1),a.length||this.lastSelectedFilter!==t||(this.lastSelectedFilter=null)),this.updateSearchFilter(t),this.scheduleFetch()}},clearFilters(){const{selectedOptions:t}=this;for(const e in t)t[e]&&(t[e]=[],this.updateSearchFilter(e));this.fetchItems()},setSortOrder(t){this.selectedSortOption=t,this.ecomSearch.setSortOrder(t),this.page>1?this.page=1:this.scheduleFetch()}},watch:{term(){this.resetAndFetch()},brands(){this.resetAndFetch()},categories(){this.resetAndFetch()},page(t){this.ecomSearch.setPageNumber(t),this.scheduleFetch()},isSearching(t){!t&&this.loadObserver&&this.$nextTick((()=>{this.loadObserver.observe()}))}},created(){d(this),this.handlePresetedOptions(),this.fetchItems()}};e.a=u},266:function(t,e,s){"use strict";s.d(e,"a",(function(){return i})),s.d(e,"b",(function(){return a}));var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"search-engine"},[t.isMobile?s("a-backdrop",{attrs:{"is-visible":t.isAsideVisible},on:{"update:isVisible":function(e){t.isAsideVisible=e},"update:is-visible":function(e){t.isAsideVisible=e}}}):t._e(),t.isMobile?s("transition",{attrs:{"enter-active-class":"animated slideInRight","leave-active-class":"animated slideOutRight"}},[s("aside",{directives:[{name:"show",rawName:"v-show",value:t.isAsideVisible,expression:"isAsideVisible"}],staticClass:"search-engine__aside card shadow"},[s("strong",{staticClass:"filters-title"},[t._v("Filtros")]),t._t("filters",(function(){return[s("header",{staticClass:"card-header"},[t._v(" "+t._s(t.i19refineSearch)+" "),s("button",{staticClass:"close",attrs:{type:"button","aria-label":t.i19closeFilters},on:{click:t.toggleFilters}},[s("span",{attrs:{"aria-hidden":"true"}},[t._v("Ã—")])])]),s("div",{key:t.searchFilterId,staticClass:"card-body"},t._l(t.filters,(function(e,i){var a=e.filter,r=e.options;e.isSpec;return r.length?s("div",{key:"filters-"+a,staticClass:"search-engine__filter",class:"search-engine__filter--"+a},[t._o([s("button",{staticClass:"btn",attrs:{type:"button","data-toggle":"collapse","data-target":"#collapse-"+a,"aria-expanded":!0,"aria-controls":"collapse-"+a}},[s("i",{staticClass:"fas fa-chevron-down"}),s("i",{staticClass:"fas fa-chevron-up"}),t._v(" "+t._s(t.getFilterLabel(a))+" ")]),s("div",{staticClass:"collapse show",attrs:{id:"collapse-"+a}},t._l(r,(function(e,i){return s("div",{key:a+"-"+i,staticClass:"search-engine__option custom-control custom-checkbox"},[s("input",{staticClass:"custom-control-input",attrs:{type:"checkbox",id:a+"-"+i},domProps:{checked:t.selectedOptions[a].indexOf(e.key)>-1},on:{change:function(s){return t.setFilterOption(a,e.key,s.target.checked)}}}),s("label",{staticClass:"custom-control-label",attrs:{for:a+"-"+i}},[t._v(" "+t._s(e.key)+" ")])])})),0)],0,"filters-"+a)],2):t._e()})),0),s("footer",{staticClass:"card-footer"},[s("button",{staticClass:"btn btn-sm btn-block btn-outline-secondary",attrs:{type:"button"},on:{click:t.clearFilters}},[s("span",{staticClass:"mr-1"},[s("i",{staticClass:"fas fa-trash-alt"})]),t._v(" "+t._s(t.i19clearFilters)+" ")])])]}))],2)]):t._e(),s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-3 col-12"},[t.isMobile?t._e():s("aside",{staticClass:"search-engine__aside card shadow"},[s("strong",{staticClass:"filters-title"},[t._v("Filtros")]),t._t("filters",(function(){return[s("header",{staticClass:"card-header"},[t._v(" "+t._s(t.i19refineSearch)+" "),s("button",{staticClass:"close",attrs:{type:"button","aria-label":t.i19closeFilters},on:{click:t.toggleFilters}},[s("span",{attrs:{"aria-hidden":"true"}},[t._v("Ã—")])])]),s("div",{key:t.searchFilterId,staticClass:"card-body"},t._l(t.filters,(function(e,i){var a=e.filter,r=e.options;e.isSpec;return r.length?s("div",{key:"filters-"+a,staticClass:"search-engine__filter",class:"search-engine__filter--"+a},[t._o([s("button",{staticClass:"btn",attrs:{type:"button","data-toggle":"collapse","data-target":"#collapse-"+a,"aria-expanded":!0,"aria-controls":"collapse-"+a}},[s("i",{staticClass:"fas fa-chevron-down"}),s("i",{staticClass:"fas fa-chevron-up"}),t._v(" "+t._s(t.getFilterLabel(a))+" ")]),s("div",{staticClass:"collapse show",attrs:{id:"collapse-"+a}},t._l(r,(function(e,i){return s("div",{key:a+"-"+i,staticClass:"search-engine__option custom-control custom-checkbox"},[s("input",{staticClass:"custom-control-input",attrs:{type:"checkbox",id:a+"-"+i},domProps:{checked:t.selectedOptions[a].indexOf(e.key)>-1},on:{change:function(s){return t.setFilterOption(a,e.key,s.target.checked)}}}),s("label",{staticClass:"custom-control-label",attrs:{for:a+"-"+i}},[t._v(" "+t._s(e.key)+" ")])])})),0)],1,"filters-"+a)],2):t._e()})),0),s("footer",{staticClass:"card-footer"},[s("button",{staticClass:"btn btn-sm btn-block btn-outline-secondary",attrs:{type:"button"},on:{click:t.clearFilters}},[t._m(0),t._v(" "+t._s(t.i19clearFilters)+" ")])])]}))],2),s("span",{attrs:{id:"custom-backdrop"}})]),s("div",{staticClass:"col-md-9 col-12"},[s("transition",{attrs:{"enter-active-class":"animated fadeInRight slower","leave-active-class":"animated fadeOutRight"}},[t.isNavVisible&&t.hasFilters?s("button",{staticClass:"search-engine__aside-open btn btn-secondary",attrs:{type:"button","aria-label":t.i19filterResults,disabled:t.isSearching},on:{click:function(e){return t.toggleFilters(!0)}}},[t.isSearching?s("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status"}},[s("span",{staticClass:"sr-only"},[t._v("Loading...")])]):s("span",[s("span",{staticClass:"d-none d-md-inline"},[s("i",{staticClass:"fas fa-search"})]),s("i",{staticClass:"fas fa-filter"})])]):t._e()]),s("transition",{attrs:{"enter-active-class":"animated fadeInDown","leave-active-class":"animated fadeOutUp fast position-absolute"}},[t.isNavVisible?s("div",{staticClass:"search-engine__nav"},[s("div",{staticClass:"container"},[t._t("nav",(function(){return[s("div",{staticClass:"search-engine__count"},[s("strong",[t._v(t._s(t.totalSearchResults))]),t._v(" "+t._s(t.i19itemsFound)+" "),t.isSearching?s("div",{staticClass:"search-engine__spinner spinner-grow",attrs:{role:"status"}},[s("span",{staticClass:"sr-only"},[t._v("Loading...")])]):t._e()]),t.isFilterable?s("div",{staticClass:"search-engine__toggles"},[t.hasFilters?s("button",{staticClass:"btn btn-light",attrs:{type:"button"},on:{click:function(e){return t.toggleFilters(!0)}}},[s("i",{staticClass:"fas fa-filter mr-1"}),s("span",{staticClass:"d-none d-md-inline"},[t._v(" "+t._s(t.i19filterResults)+" ")]),s("span",{staticClass:"d-md-none"},[t._v(" "+t._s(t.i19filter)+" ")])]):t._e(),s("div",{staticClass:"dropdown"},[s("button",{staticClass:"btn btn-light",attrs:{type:"button",id:"search-engine-sort","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}},[s("i",{staticClass:"fas fa-sort mr-1"}),t._v(" "+t._s(t.i19sort)+" ")]),s("div",{staticClass:"dropdown-menu dropdown-menu-right",attrs:{"aria-labelledby":"search-engine-sort"}},t._l(t.sortOptions,(function(e,i){var a=e.value,r=e.label;return s("a",{key:"sort-"+i,staticClass:"dropdown-item",class:"search-engine__sort--"+a,attrs:{href:"#",active:t.selectedSortOption===a},on:{click:function(e){return e.preventDefault(),t.setSortOrder(a)}}},[t._v(" "+t._s(r)+" ")])})),0)])]):t._e()]}),null,{totalSearchResults:t.totalSearchResults,toggleFilters:t.toggleFilters})],2)]):t._e()]),s("transition",{attrs:{"enter-active-class":"animated fadeIn slower"}},[t.isResultsVisible?s("div",{staticClass:"search-engine__results fade",style:{opacity:t.isSearching&&!t.isLoadingMore?.4:1}},[s("div",{staticClass:"container"},[s("div",{staticClass:"search-engine__info px-lg-4"},[t.term?[t.hasEmptyResult?s("div",{staticClass:"search-engine__no-results"},[s("div",{staticClass:"lead mb-2"},[t.suggestedTerm?s("span",[t._v(" "+t._s(t.i19didYouMean)+" "),s("a",{attrs:{href:"#"},domProps:{textContent:t._s(t.suggestedTerm)},on:{click:function(e){return e.preventDefault(),t.$emit("update:term",t.suggestedTerm)}}}),t._v(" ? ")]):t._e(),t._v(" "+t._s(t.i19noResultsFor)+" "),s("em",[t._v(t._s(t.term))])]),t.popularItems.length?s("h4",[t._v(" "+t._s(t.i19popularProducts)+" ")]):t._e()]):s("div",{staticClass:"search-engine__terms"},[t.noResultsTerm?s("span",{staticClass:"d-none d-lg-inline"},[t._v(" "+t._s(t.i19noResultsFor)+" "),s("s",[t._v(t._s(t.noResultsTerm))]),t._v(". ")]):t._e(),s("span",{staticClass:"d-none d-md-inline"},[t._v(" "+t._s(t.i19searchingFor)+": ")]),s("h1",[t._v(t._s(t.term))])])]:t.popularItems.length?s("h3",[t._v(" "+t._s(t.i19popularProducts)+" ")]):t._e(),s("transition",{attrs:{"enter-active-class":"animated fadeInDown","leave-active-class":"animated fadeOutUp"}},[t.hasSelectedOptions&&t.isFilterable?s("div",[s("button",{staticClass:"btn btn-sm btn-outline-secondary",attrs:{type:"button"},on:{click:t.clearFilters}},[s("i",{staticClass:"fas fa-trash-alt mr-1"}),t._v(" "+t._s(t.i19clearFilters)+" ")]),t._l(t.selectedOptions,(function(e,i){return t._l(e,(function(e){return s("button",{staticClass:"search-engine__selected btn btn-sm btn-light",attrs:{type:"button"},on:{click:function(s){return t.setFilterOption(i,e,!1)}}},[s("i",{staticClass:"fas fa-times mr-1"}),t._v(" "+t._s(e)+" "),s("small",[t._v(t._s(t.getFilterLabel(i)))])])}))}))],2):t._e()])],2),t.canShowItems?s("article",{staticClass:"search-engine__retail"},[s("div",{staticClass:"row"},t._l(t.suggestedItems,(function(e){return s("div",{key:e._id,staticClass:"col-6 col-md-4"},[t._t("product-card",(function(){return[s("product-card",t._b({staticClass:"search-engine__item",attrs:{product:e}},"product-card",t.productCardProps,!1))]}),null,{product:e})],2)})),0)]):t._e(),s("transition",{attrs:{"enter-active-class":"animated fadeInDown"}},[t.hasNetworkError?s("div",{staticClass:"alert alert-warning",attrs:{role:"alert"}},[s("i",{staticClass:"fas fa-wifi mr-2"}),t._v(" "+t._s(t.i19searchOfflineErrorMsg)+" "),s("a",{staticClass:"alert-link",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.fetchItems.apply(null,arguments)}}},[t._v(" "+t._s(t.i19searchAgain)+" ")])]):t._e()])],1)]):t._e()]),s("transition",{attrs:{"leave-active-class":"animated fadeOut"}},[!t.hasSearched||t.isLoadingMore?t._t("default"):t._e()],2),s(t.loadMoreSelector?"portal":"div",{tag:"component",attrs:{selector:t.loadMoreSelector}},[t.resultItems.length<t.totalSearchResults?s("div",{key:t.lastRequestId,staticStyle:{width:"100%","margin-top":"20px",height:"5px"},attrs:{id:"search-engine-load-more"}}):t._e()])],1)])],1)},a=[function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"mr-1"},[e("i",{staticClass:"fas fa-trash-alt"})])}]}}]);